{{define "content"}}
<div
  class="w-full block p-6 rounded-lg shadow-lg bg-white"
  x-data="shareForm()"
>
  <h2 x-text="message" class="pb-4 pt-1"></h2>
  <form action="/api/share" method="POST" @submit.prevent="submitData">
    <div class="form-group mb-6">
      <input
        type="text"
        class="form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
        id="url"
        placeholder="URL"
        x-model="formData.URL"
      />
    </div>
    <div class="form-group mb-6">
      <input
        type="text"
        class="form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
        id="title"
        placeholder="Title"
        x-model="formData.title"
      />
    </div>
    <div class="form-group mb-6">
      <input
        type="text"
        class="form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"
        id="comment"
        rows="5"
        placeholder="Comment"
        x-model="formData.comment"
      />
    </div>
    <button
      type="submit"
      class="w-full px-6 py-2.5 bg-blue-600 text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out"
    >
      Share
    </button>
  </form>
</div>
<script>
  function shareForm() {
    return {
      formData: {
        URL: "",
        title: "",
        comment: "",
      },
      message: "Share an article",
      // fetch API error handler
      handleErrors(response) {
        if (response.status >= 200 && response.status <= 299) {
          return response.json();
        } else {
          let err = new Error(response.statusText);
          err.response = response;
          throw err;
        }
      },

      submitData() {
        fetch("/api/share", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(this.formData),
        })
          // handle network err/success
          .then(this.handleErrors)
          // use response of network on fetch Promise resolve
          .then((jsonResponse) => {
            console.log("ok");
            console.log(jsonResponse);
            this.message = "URL shared successfully!";
          })
          .catch((err) => {
            console.log(err);
            this.message = "Couldn't share article: " + err;
          });
      },
    };
  }
</script>
{{end}}
